# SPDX-License-Identifier: PMPL-1.0-or-later
# Caddyfile â€” Reverse proxy for BigBlueButton / Greenlight

conference.nuj-lcb.org.uk {
    reverse_proxy greenlight:3000 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}

        # WebSocket support for live sessions
        transport http {
            read_timeout 300s
            write_timeout 300s
        }
    }

    header {
        X-Content-Type-Options nosniff
        X-Frame-Options SAMEORIGIN
        Referrer-Policy strict-origin-when-cross-origin
        Permissions-Policy "geolocation=(), microphone=(self), camera=(self)"
        -Server
    }

    log {
        output file /data/access.log {
            roll_size 10mb
            roll_keep 5
        }
    }
}
